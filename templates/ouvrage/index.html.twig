{% extends 'base.html.twig' %}
{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('styles/ouvrages.css') }}">
{% endblock %}
{% block body %}
<div class="search-container">
    {% if searchForm is defined %}
        {{ form_start(searchForm, { method: 'get', attr: { class: 'search-form' } }) }}
            <div class="form-inputs">
                {{ form_row(searchForm.titre) }}
                {{ form_row(searchForm.categories) }}
                {{ form_row(searchForm.langues) }}
                <div class="year-range">
                    {{ form_row(searchForm.year_from) }}
                    {{ form_row(searchForm.year_to) }}
                </div>
                {{ form_row(searchForm.disponible) }}
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    Filtrer
                </button>
                <a href="{{ path('app_ouvrages') }}" class="btn btn-secondary">Réinitialiser</a>
                <a href="{{ path('app_user_reservations') }}" class="btn btn-primary">Voir mes réservations</a>
                <button onclick="location.href='{{ path('app_ouvrage_new') }}'" class="btn btn-admin">Créer un ouvrage</button>
                <button onclick="location.href='{{ path('app_regles_emprunts') }}'" class="btn btn-admin">Paramètres des emprunts</button>
                <button onclick="location.href='{{ path('dashboard_admin') }}'" class="btn btn-admin">Tableau de bord</button>
            </div>
        {{ form_end(searchForm) }}
    {% endif %}
</div>

<div class="ouvrages-grid">
    {% for ouvrage in ouvrages %}
        <div class="ouvrage-card" onclick="location.href='{{ path('app_ouvrage_detail', {'id': ouvrage.id}) }}'">
            <div class="card-header">
                <h2 class="card-title">{{ ouvrage.Titre|e }}</h2>
            </div>
            
            <div class="card-body">
                <div class="card-info">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    {% if (ouvrage.Auteurs is defined and ouvrage.Auteurs is not empty) %}
                        <span>{{ ouvrage.Auteurs|join(', ') }}</span>
                    {% else %}
                        <span class="text-muted">Auteur inconnu</span>
                    {% endif %}
                </div>

                <div class="card-info">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    <span>{{ ouvrage.Editeur|default('—') }}</span>
                </div>

                <div class="card-info">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span>{{ (ouvrage.Annee is defined and ouvrage.Annee) ? ouvrage.Annee|date('Y') : '—' }}</span>
                </div>

                {% if ouvrage.Resume is defined and ouvrage.Resume %}
                    <p class="card-resume">{{ ouvrage.Resume }}</p>
                {% endif %}
            </div>

            <div class="card-footer">
                <span class="view-details">Voir les détails →</span>
            </div>
        </div>
    {% else %}
        <div class="no-results">
            <svg class="no-results-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <p>Aucun ouvrage trouvé</p>
            <a href="{{ path('app_ouvrages') }}" class="btn btn-primary">Réinitialiser les filtres</a>
        </div>
    {% endfor %}
</div>
{% endblock %}